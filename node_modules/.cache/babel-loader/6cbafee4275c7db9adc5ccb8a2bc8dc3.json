{"ast":null,"code":"import { DEFAULT_FORMAT_CHARACTERS, DEFAULT_PLACEHOLDER_CHAR, ESCAPE_CHAR } from './helpers';\nexport class Pattern {\n  constructor(source, formatCharacters, placeholderChar, isRevealingMask = false) {\n    /** Pattern characters after escape characters have been processed. */\n    this.pattern = [];\n    /** Length of the pattern after escape characters have been processed. */\n\n    this.length = 0;\n    /** Index of the first editable character. */\n\n    this.firstEditableIndex = null;\n    /** Index of the last editable character. */\n\n    this.lastEditableIndex = null;\n    /** Lookup for indices of editable characters in the pattern. */\n\n    this._editableIndices = {};\n    /** Placeholder character */\n\n    this.placeholderChar = placeholderChar || DEFAULT_PLACEHOLDER_CHAR;\n    /** Format character definitions. */\n\n    this.formatCharacters = formatCharacters || DEFAULT_FORMAT_CHARACTERS;\n    /** Pattern definition string with escape characters. */\n\n    this.source = source;\n    this.isRevealingMask = isRevealingMask;\n\n    this._parse();\n  }\n\n  _parse() {\n    var sourceChars = this.source.split('');\n    var patternIndex = 0;\n    var pattern = [];\n\n    for (var i = 0, l = sourceChars.length; i < l; i++) {\n      var char = sourceChars[i];\n\n      if (char === ESCAPE_CHAR) {\n        if (i === l - 1) {\n          throw new Error('InputMask: pattern ends with a raw ' + ESCAPE_CHAR);\n        }\n\n        char = sourceChars[++i];\n      } else if (char in this.formatCharacters) {\n        if (this.firstEditableIndex === null) {\n          this.firstEditableIndex = patternIndex;\n        }\n\n        this.lastEditableIndex = patternIndex;\n        this._editableIndices[patternIndex] = true;\n      }\n\n      pattern.push(char);\n      patternIndex++;\n    }\n\n    if (this.firstEditableIndex === null) {\n      throw new Error('InputMask: pattern \"' + this.source + '\" does not contain any editable characters.');\n    } // @ts-ignore\n\n\n    this.pattern = pattern;\n    this.length = pattern.length;\n  }\n\n  formatValue(value) {\n    var valueBuffer = new Array(this.length);\n    var valueIndex = 0;\n\n    for (var i = 0, l = this.length; i < l; i++) {\n      if (this.isEditableIndex(i)) {\n        if (this.isRevealingMask && value.length <= valueIndex && !this.isValidAtIndex(value[valueIndex], i)) {\n          break;\n        }\n\n        valueBuffer[i] = value.length > valueIndex && this.isValidAtIndex(value[valueIndex], i) ? this.transform(value[valueIndex], i) : this.placeholderChar;\n        valueIndex++;\n      } else {\n        valueBuffer[i] = this.pattern[i]; // Also allow the value to contain static values from the pattern by\n        // advancing its index.\n\n        if (value.length > valueIndex && value[valueIndex] === this.pattern[i]) {\n          valueIndex++;\n        }\n      }\n    }\n\n    return valueBuffer;\n  }\n\n  isEditableIndex(index) {\n    return !!this._editableIndices[index];\n  }\n\n  isValidAtIndex(char, index) {\n    return this.formatCharacters[this.pattern[index]].validate(char);\n  }\n\n  transform(char, index) {\n    var format = this.formatCharacters[this.pattern[index]];\n    return typeof format.transform == 'function' ? format.transform(char) : char;\n  }\n\n}","map":{"version":3,"sources":["../../../src/lib/Pattern.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { DEFAULT_FORMAT_CHARACTERS, DEFAULT_PLACEHOLDER_CHAR, ESCAPE_CHAR, } from './helpers';\nexport class Pattern {\n    constructor(source, formatCharacters, placeholderChar, isRevealingMask = false) {\n        /** Pattern characters after escape characters have been processed. */\n        this.pattern = [];\n        /** Length of the pattern after escape characters have been processed. */\n        this.length = 0;\n        /** Index of the first editable character. */\n        this.firstEditableIndex = null;\n        /** Index of the last editable character. */\n        this.lastEditableIndex = null;\n        /** Lookup for indices of editable characters in the pattern. */\n        this._editableIndices = {};\n        /** Placeholder character */\n        this.placeholderChar = placeholderChar || DEFAULT_PLACEHOLDER_CHAR;\n        /** Format character definitions. */\n        this.formatCharacters = formatCharacters || DEFAULT_FORMAT_CHARACTERS;\n        /** Pattern definition string with escape characters. */\n        this.source = source;\n        this.isRevealingMask = isRevealingMask;\n        this._parse();\n    }\n    _parse() {\n        var sourceChars = this.source.split('');\n        var patternIndex = 0;\n        var pattern = [];\n        for (var i = 0, l = sourceChars.length; i < l; i++) {\n            var char = sourceChars[i];\n            if (char === ESCAPE_CHAR) {\n                if (i === l - 1) {\n                    throw new Error('InputMask: pattern ends with a raw ' + ESCAPE_CHAR);\n                }\n                char = sourceChars[++i];\n            }\n            else if (char in this.formatCharacters) {\n                if (this.firstEditableIndex === null) {\n                    this.firstEditableIndex = patternIndex;\n                }\n                this.lastEditableIndex = patternIndex;\n                this._editableIndices[patternIndex] = true;\n            }\n            pattern.push(char);\n            patternIndex++;\n        }\n        if (this.firstEditableIndex === null) {\n            throw new Error('InputMask: pattern \"' + this.source + '\" does not contain any editable characters.');\n        }\n        // @ts-ignore\n        this.pattern = pattern;\n        this.length = pattern.length;\n    }\n    formatValue(value) {\n        var valueBuffer = new Array(this.length);\n        var valueIndex = 0;\n        for (var i = 0, l = this.length; i < l; i++) {\n            if (this.isEditableIndex(i)) {\n                if (this.isRevealingMask &&\n                    value.length <= valueIndex &&\n                    !this.isValidAtIndex(value[valueIndex], i)) {\n                    break;\n                }\n                valueBuffer[i] =\n                    value.length > valueIndex && this.isValidAtIndex(value[valueIndex], i)\n                        ? this.transform(value[valueIndex], i)\n                        : this.placeholderChar;\n                valueIndex++;\n            }\n            else {\n                valueBuffer[i] = this.pattern[i];\n                // Also allow the value to contain static values from the pattern by\n                // advancing its index.\n                if (value.length > valueIndex && value[valueIndex] === this.pattern[i]) {\n                    valueIndex++;\n                }\n            }\n        }\n        return valueBuffer;\n    }\n    isEditableIndex(index) {\n        return !!this._editableIndices[index];\n    }\n    isValidAtIndex(char, index) {\n        return this.formatCharacters[this.pattern[index]].validate(char);\n    }\n    transform(char, index) {\n        var format = this.formatCharacters[this.pattern[index]];\n        return typeof format.transform == 'function' ? format.transform(char) : char;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUGF0dGVybi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvUGF0dGVybi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wseUJBQXlCLEVBQ3pCLHdCQUF3QixFQUN4QixXQUFXLEdBRVosTUFBTSxXQUFXLENBQUM7QUFFbkIsTUFBTSxPQUFPLE9BQU87SUF1QmxCLFlBQ0UsTUFBYyxFQUNkLGdCQUFrQyxFQUNsQyxlQUF1QixFQUN2QixlQUFlLEdBQUcsS0FBSztRQXRCekIsc0VBQXNFO1FBQ3RFLFlBQU8sR0FBRyxFQUFFLENBQUM7UUFFYix5RUFBeUU7UUFDekUsV0FBTSxHQUFHLENBQUMsQ0FBQztRQUVYLDZDQUE2QztRQUM3Qyx1QkFBa0IsR0FBa0IsSUFBSSxDQUFDO1FBRXpDLDRDQUE0QztRQUM1QyxzQkFBaUIsR0FBa0IsSUFBSSxDQUFDO1FBRXhDLGdFQUFnRTtRQUNoRSxxQkFBZ0IsR0FBK0IsRUFBRSxDQUFDO1FBV2hELDRCQUE0QjtRQUM1QixJQUFJLENBQUMsZUFBZSxHQUFHLGVBQWUsSUFBSSx3QkFBd0IsQ0FBQztRQUNuRSxvQ0FBb0M7UUFDcEMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLGdCQUFnQixJQUFJLHlCQUF5QixDQUFDO1FBQ3RFLHdEQUF3RDtRQUN4RCxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUVyQixJQUFJLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQztRQUV2QyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDaEIsQ0FBQztJQUVELE1BQU07UUFDSixJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN4QyxJQUFJLFlBQVksR0FBRyxDQUFDLENBQUM7UUFDckIsSUFBSSxPQUFPLEdBQWEsRUFBRSxDQUFDO1FBRTNCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FB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"]},"metadata":{},"sourceType":"module"}