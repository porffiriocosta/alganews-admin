{"ast":null,"code":"import _regeneratorRuntime from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{Route,Switch,useHistory,useLocation}from'react-router-dom';import HomeView from'./views/Home.view';import UserCreateView from'./views/UserCreate.view';import UserEditView from'./views/UserEdit.view';import UserListView from'./views/UserList.view';import PaymentListView from'./views/PaymentList.view';import PaymentCreateView from'./views/PaymentCreate.view';import CashFlowRevenuesView from'./views/CashFlowRevenues.view';import CashFlowExpensesView from'./views/CashFlowExpenses.view';import{useEffect}from'react';import CustomError from'danielbonifacio-sdk/dist/CustomError';import{message,notification}from'antd';import UserDetailsView from'./views/UserDetails.view';import PaymentDetailsView from'./views/PaymentDetails.view';import AuthService from'../auth/Authorization.service';import jwtDecode from'jwt-decode';import useAuth from'../core/hooks/useAuth';import{useMemo}from'react';import GlobalLoading from'./components/GlobalLoading';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var APP_BASE_URL=process.env.REACT_APP_BASE_URL;export default function Routes(){var history=useHistory();var location=useLocation();var _useAuth=useAuth(),fetchUser=_useAuth.fetchUser,user=_useAuth.user;useEffect(function(){window.onunhandledrejection=function(_ref){var reason=_ref.reason;if(reason instanceof CustomError){var _reason$data;if((_reason$data=reason.data)===null||_reason$data===void 0?void 0:_reason$data.objects){reason.data.objects.forEach(function(error){message.error(error.userMessage);});}else{var _reason$data2,_reason$data3;notification.error({message:reason.message,description:((_reason$data2=reason.data)===null||_reason$data2===void 0?void 0:_reason$data2.detail)==='Network Error'?'Erro na rede':(_reason$data3=reason.data)===null||_reason$data3===void 0?void 0:_reason$data3.detail});}}else{var _reason$data4,_reason$data4$objects;reason===null||reason===void 0?void 0:(_reason$data4=reason.data)===null||_reason$data4===void 0?void 0:(_reason$data4$objects=_reason$data4.objects)===null||_reason$data4$objects===void 0?void 0:_reason$data4$objects.forEach(function(object){message.error(object.userMessage);});notification.error({message:(reason===null||reason===void 0?void 0:reason.message)||'Houve um erro'});}};return function(){window.onunhandledrejection=null;};},[]);useEffect(function(){function identify(){return _identify.apply(this,arguments);}function _identify(){_identify=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var isInAuthorizationRoute,code,codeVerifier,accessToken,_yield$AuthService$ge,access_token,refresh_token,decodedToken,_decodedToken;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:isInAuthorizationRoute=window.location.pathname==='/authorize';code=new URLSearchParams(window.location.search).get('code');codeVerifier=AuthService.getCodeVerifier();accessToken=AuthService.getAccessToken();if(!accessToken&&!isInAuthorizationRoute){AuthService.imperativelySendToLoginScreen();}if(!isInAuthorizationRoute){_context.next=23;break;}if(code){_context.next=10;break;}notification.error({message:'Código não foi informado'});AuthService.imperativelySendToLoginScreen();return _context.abrupt(\"return\");case 10:if(codeVerifier){_context.next=13;break;}AuthService.imperativelySendToLogout();return _context.abrupt(\"return\");case 13:_context.next=15;return AuthService.getFirstAccessTokens({code:code,codeVerifier:codeVerifier,redirectUri:\"\".concat(APP_BASE_URL,\"/authorize\")});case 15:_yield$AuthService$ge=_context.sent;access_token=_yield$AuthService$ge.access_token;refresh_token=_yield$AuthService$ge.refresh_token;AuthService.setAccessToken(access_token);AuthService.setRefreshToken(refresh_token);decodedToken=jwtDecode(access_token);fetchUser(decodedToken['alganews:user_id']);history.push('/');case 23:if(accessToken){_decodedToken=jwtDecode(accessToken);fetchUser(_decodedToken['alganews:user_id']);}case 24:case\"end\":return _context.stop();}}},_callee);}));return _identify.apply(this,arguments);}identify();},[history,fetchUser]);var isAuthorizationRoute=useMemo(function(){return location.pathname==='/authorize';},[location.pathname]);if(isAuthorizationRoute||!user)return/*#__PURE__*/_jsx(GlobalLoading,{});return/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:'/',exact:true,component:HomeView}),/*#__PURE__*/_jsx(Route,{path:'/usuarios/cadastro',exact:true,component:UserCreateView}),/*#__PURE__*/_jsx(Route,{path:'/usuarios/edicao/:id',exact:true,component:UserEditView}),/*#__PURE__*/_jsx(Route,{path:'/usuarios/:id',exact:true,component:UserDetailsView}),/*#__PURE__*/_jsx(Route,{path:'/usuarios',exact:true,component:UserListView}),/*#__PURE__*/_jsx(Route,{path:'/pagamentos',exact:true,component:PaymentListView}),/*#__PURE__*/_jsx(Route,{path:'/pagamentos/cadastro',exact:true,component:PaymentCreateView}),/*#__PURE__*/_jsx(Route,{path:'/pagamentos/:id',exact:true,component:PaymentDetailsView}),/*#__PURE__*/_jsx(Route,{path:'/fluxo-de-caixa/despesas',exact:true,component:CashFlowExpensesView}),/*#__PURE__*/_jsx(Route,{path:'/fluxo-de-caixa/receitas',exact:true,component:CashFlowRevenuesView})]});}","map":{"version":3,"sources":["D:/ReactProjetos/alganews-admin/src/app/routes.tsx"],"names":["Route","Switch","useHistory","useLocation","HomeView","UserCreateView","UserEditView","UserListView","PaymentListView","PaymentCreateView","CashFlowRevenuesView","CashFlowExpensesView","useEffect","CustomError","message","notification","UserDetailsView","PaymentDetailsView","AuthService","jwtDecode","useAuth","useMemo","GlobalLoading","APP_BASE_URL","process","env","REACT_APP_BASE_URL","Routes","history","location","fetchUser","user","window","onunhandledrejection","reason","data","objects","forEach","error","userMessage","description","detail","object","identify","isInAuthorizationRoute","pathname","code","URLSearchParams","search","get","codeVerifier","getCodeVerifier","accessToken","getAccessToken","imperativelySendToLoginScreen","imperativelySendToLogout","getFirstAccessTokens","redirectUri","access_token","refresh_token","setAccessToken","setRefreshToken","decodedToken","push","isAuthorizationRoute"],"mappings":"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","sourcesContent":["import { Route, Switch, useHistory, useLocation } from 'react-router-dom';\n\nimport HomeView from './views/Home.view';\nimport UserCreateView from './views/UserCreate.view';\nimport UserEditView from './views/UserEdit.view';\nimport UserListView from './views/UserList.view';\nimport PaymentListView from './views/PaymentList.view';\nimport PaymentCreateView from './views/PaymentCreate.view';\nimport CashFlowRevenuesView from './views/CashFlowRevenues.view';\nimport CashFlowExpensesView from './views/CashFlowExpenses.view';\nimport { useEffect } from 'react';\nimport CustomError from 'danielbonifacio-sdk/dist/CustomError';\nimport { message, notification } from 'antd';\nimport UserDetailsView from './views/UserDetails.view';\nimport PaymentDetailsView from './views/PaymentDetails.view';\nimport AuthService from '../auth/Authorization.service';\nimport jwtDecode from 'jwt-decode';\nimport useAuth from '../core/hooks/useAuth';\nimport { useMemo } from 'react';\nimport GlobalLoading from './components/GlobalLoading';\nimport { Authentication } from '../auth/Auth';\n\nconst APP_BASE_URL = process.env.REACT_APP_BASE_URL;\n\nexport default function Routes() {\n  const history = useHistory();\n  const location = useLocation();\n\n  const { fetchUser, user } = useAuth();\n\n  useEffect(() => {\n    window.onunhandledrejection = ({ reason }) => {\n      if (reason instanceof CustomError) {\n        if (reason.data?.objects) {\n          reason.data.objects.forEach((error) => {\n            message.error(error.userMessage);\n          });\n        } else {\n          notification.error({\n            message: reason.message,\n            description:\n              reason.data?.detail === 'Network Error'\n                ? 'Erro na rede'\n                : reason.data?.detail,\n          });\n        }\n      } else {\n        reason?.data?.objects?.forEach((object: { userMessage: string }) => {\n          message.error(object.userMessage);\n        });\n\n        notification.error({\n          message: reason?.message || 'Houve um erro',\n        });\n      }\n    };\n\n    return () => {\n      window.onunhandledrejection = null;\n    };\n  }, []);\n\n  useEffect(() => {\n    async function identify() {\n      const isInAuthorizationRoute = window.location.pathname === '/authorize';\n      const code = new URLSearchParams(window.location.search).get('code');\n\n      const codeVerifier = AuthService.getCodeVerifier();\n      const accessToken = AuthService.getAccessToken();\n\n      if (!accessToken && !isInAuthorizationRoute) {\n        AuthService.imperativelySendToLoginScreen();\n      }\n\n      if (isInAuthorizationRoute) {\n        if (!code) {\n          notification.error({\n            message: 'Código não foi informado',\n          });\n          AuthService.imperativelySendToLoginScreen();\n          return;\n        }\n\n        if (!codeVerifier) {\n          AuthService.imperativelySendToLogout();\n          return;\n        }\n\n        // busca o primeiro token de acesso\n        const { access_token, refresh_token } =\n          await AuthService.getFirstAccessTokens({\n            code,\n            codeVerifier,\n            redirectUri: `${APP_BASE_URL}/authorize`,\n          });\n\n        AuthService.setAccessToken(access_token);\n        AuthService.setRefreshToken(refresh_token);\n\n        const decodedToken: Authentication.AccessTokenDecodedBody =\n          jwtDecode(access_token);\n        fetchUser(decodedToken['alganews:user_id']);\n        history.push('/');\n      }\n\n      if (accessToken) {\n        const decodedToken: Authentication.AccessTokenDecodedBody =\n          jwtDecode(accessToken);\n        fetchUser(decodedToken['alganews:user_id']);\n      }\n    }\n\n    identify();\n  }, [history, fetchUser]);\n\n  const isAuthorizationRoute = useMemo(\n    () => location.pathname === '/authorize',\n    [location.pathname]\n  );\n\n  if (isAuthorizationRoute || !user) return <GlobalLoading />;\n\n  return (\n    <Switch>\n      <Route path={'/'} exact component={HomeView} />\n      <Route path={'/usuarios/cadastro'} exact component={UserCreateView} />\n      <Route path={'/usuarios/edicao/:id'} exact component={UserEditView} />\n      <Route path={'/usuarios/:id'} exact component={UserDetailsView} />\n      <Route path={'/usuarios'} exact component={UserListView} />\n      <Route path={'/pagamentos'} exact component={PaymentListView} />\n      <Route\n        path={'/pagamentos/cadastro'}\n        exact\n        component={PaymentCreateView}\n      />\n      <Route path={'/pagamentos/:id'} exact component={PaymentDetailsView} />\n      <Route\n        path={'/fluxo-de-caixa/despesas'}\n        exact\n        component={CashFlowExpensesView}\n      />\n      <Route\n        path={'/fluxo-de-caixa/receitas'}\n        exact\n        component={CashFlowRevenuesView}\n      />\n    </Switch>\n  );\n}"]},"metadata":{},"sourceType":"module"}