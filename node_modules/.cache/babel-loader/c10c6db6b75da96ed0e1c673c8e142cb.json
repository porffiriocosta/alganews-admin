{"ast":null,"code":"import _regeneratorRuntime from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Button,DatePicker,Descriptions,notification,Popconfirm,Row,Space,Table,Tag,Tooltip}from'antd';import moment from'moment';import{useEffect,useState}from'react';import{EyeOutlined,DeleteOutlined}from'@ant-design/icons';import usePayments from'../../core/hooks/usePayments';import confirm from'antd/lib/modal/confirm';import useBreakpoint from'antd/lib/grid/hooks/useBreakpoint';import DoubleConfirm from'../components/DoubleConfirm';import{Link}from'react-router-dom';import Forbidden from'../components/Forbidden';import useBreadcrumb from'../../core/hooks/useBreadcrumb';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function PaymentListView(){useBreadcrumb('Pagamentos/Consulta');var _useBreakpoint=useBreakpoint(),xs=_useBreakpoint.xs;var _usePayments=usePayments(),payments=_usePayments.payments,fetching=_usePayments.fetching,query=_usePayments.query,selected=_usePayments.selected,fetchPayments=_usePayments.fetchPayments,setQuery=_usePayments.setQuery,approvePaymentsInBatch=_usePayments.approvePaymentsInBatch,setSelected=_usePayments.setSelected,deleteExistingPayment=_usePayments.deleteExistingPayment;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),forbidden=_useState2[0],setForbidden=_useState2[1];useEffect(function(){fetchPayments().catch(function(err){var _err$data;if((err===null||err===void 0?void 0:(_err$data=err.data)===null||_err$data===void 0?void 0:_err$data.status)===403){setForbidden(true);return;}throw err;});},[fetchPayments]);if(forbidden)return/*#__PURE__*/_jsx(Forbidden,{});return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Row,{justify:'space-between',gutter:24,children:/*#__PURE__*/_jsxs(Space,{style:_objectSpread({width:'100%'},!xs&&{justifyContent:'space-between'}),direction:xs?'vertical':'horizontal',children:[/*#__PURE__*/_jsx(DoubleConfirm,{popConfirmTitle:selected.length===1?'Você deseja aprovar o agendamento selecionado?':'Você deseja aprovar os agendamentos selecionados?',disabled:selected.length===0,modalTitle:'Aprovar agendamento',modalContent:'Esta é uma ação irreversível. Ao aprovar um agendamento, ele não poderá ser removido!',onConfirm:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return approvePaymentsInBatch(selected);case 2:notification.success({message:'Os pagamentos selecionados foram aprovados'});case 3:case\"end\":return _context.stop();}}},_callee);})),children:/*#__PURE__*/_jsx(Button,{block:xs,type:'primary',disabled:selected.length===0,children:\"Aprovar agendamentos\"})}),/*#__PURE__*/_jsx(DatePicker.MonthPicker,{style:{width:xs?'100%':240},format:'MMMM - YYYY',placeholder:'Filtrar por mês',onChange:function onChange(date){setQuery({scheduledToYearMonth:date?date.format('YYYY-MM'):undefined});}})]})}),/*#__PURE__*/_jsx(Table,{dataSource:payments===null||payments===void 0?void 0:payments.content,rowKey:\"id\",loading:fetching,onChange:function onChange(p,f,sorter){var _ref2=sorter,order=_ref2.order;var direction=order===null||order===void 0?void 0:order.replace('end','');if(direction&&direction!==query.sort[1])setQuery({sort:[query.sort[0],direction]});},pagination:{current:query.page?query.page+1:1,onChange:function onChange(page){return setQuery({page:page-1});},total:payments===null||payments===void 0?void 0:payments.totalElements,pageSize:query.size},rowSelection:{selectedRowKeys:selected,onChange:setSelected,getCheckboxProps:function getCheckboxProps(payment){return!payment.canBeApproved?{disabled:true}:{};}},columns:[{title:'Agendamentos',responsive:['xs'],render:function render(payment){return/*#__PURE__*/_jsxs(Descriptions,{column:1,size:'small',children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:'Editor',children:payment.payee.name}),/*#__PURE__*/_jsx(Descriptions.Item,{label:'Agendamento',children:moment(payment.scheduledTo).format('DD/MM/YYYY')}),/*#__PURE__*/_jsx(Descriptions.Item,{label:'Período',children:function(){var starts=moment(payment.accountingPeriod.startsOn).format('DD/MM/YYYY');var ends=moment(payment.accountingPeriod.endsOn).format('DD/MM/YYYY');return\"\".concat(starts,\" - \").concat(ends);}()}),/*#__PURE__*/_jsx(Descriptions.Item,{label:'Status',children:/*#__PURE__*/_jsx(Tag,{color:payment.approvedAt?'green':'warning',children:payment.approvedAt?\"Aprovado em \".concat(moment(payment.approvedAt).format('DD/MM/YYYY')):'Aguardando aprovação'})}),/*#__PURE__*/_jsxs(Descriptions.Item,{label:'Ações',children:[/*#__PURE__*/_jsx(Tooltip,{title:'Detalhar',placement:xs?'top':'left',children:/*#__PURE__*/_jsx(Link,{to:\"/pagamentos/\".concat(payment.id),children:/*#__PURE__*/_jsx(Button,{size:'small',icon:/*#__PURE__*/_jsx(EyeOutlined,{})})})}),/*#__PURE__*/_jsx(Popconfirm,{title:\"Remover agendamento?\",disabled:!payment.canBeDeleted,onConfirm:function onConfirm(){confirm({title:'Remover agendamento',cancelText:'Cancelar',onOk:function onOk(){deleteExistingPayment(payment.id);},content:'Esta é uma ação irreversível. Ao remover um agendamento, ele não poderá ser recuperado!'});},children:/*#__PURE__*/_jsx(Tooltip,{title:payment.canBeDeleted?'Remover':'Pagamento já aprovado',placement:xs?'bottom':'right',children:/*#__PURE__*/_jsx(Button,{disabled:!payment.canBeDeleted,icon:/*#__PURE__*/_jsx(DeleteOutlined,{}),size:'small'})})})]})]});}},{dataIndex:'payee',title:'Editor',responsive:['sm'],ellipsis:true,width:180,render:function render(payee){return/*#__PURE__*/_jsx(Link,{to:\"/usuarios/\".concat(payee.id),children:payee.name});}},{dataIndex:'scheduledTo',title:'Agendamento',align:'center',width:140,sorter:function sorter(a,b){return 0;},responsive:['sm'],render:function render(date){return moment(date).format('DD/MM/YYYY');}},{dataIndex:'accountingPeriod',title:'Período',align:'center',responsive:['sm'],width:240,render:function render(period){var starts=moment(period.startsOn).format('DD/MM/YYYY');var ends=moment(period.endsOn).format('DD/MM/YYYY');return\"\".concat(starts,\" - \").concat(ends);}},{dataIndex:'approvedAt',title:'Status',align:'center',width:180,responsive:['sm'],render:function render(approvalDate){var formattedApprovalDate=moment(approvalDate).format('DD/MM/YYYY');return/*#__PURE__*/_jsx(Tag,{color:approvalDate?'green':'warning',children:approvalDate?\"Aprovado em \".concat(formattedApprovalDate):'Aguardando aprovação'});}},{dataIndex:'id',title:'Ações',responsive:['sm'],width:100,render:function render(id,payment){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Tooltip,{title:'Detalhar',placement:\"left\",children:/*#__PURE__*/_jsx(Link,{to:\"/pagamentos/\".concat(id),children:/*#__PURE__*/_jsx(Button,{size:\"small\",icon:/*#__PURE__*/_jsx(EyeOutlined,{})})})}),/*#__PURE__*/_jsx(Popconfirm,{title:\"Remover agendamento?\",disabled:!payment.canBeDeleted,onConfirm:function onConfirm(){confirm({title:'Remover agendamento',cancelText:'Cancelar',onOk:function onOk(){deleteExistingPayment(id);},content:'Esta é uma ação irreversível. Ao remover um agendamento, ele não poderá ser recuperado!'});},children:/*#__PURE__*/_jsx(Tooltip,{title:payment.canBeDeleted?'Remover':'Pagamento já aprovado',placement:\"right\",children:/*#__PURE__*/_jsx(Button,{size:\"small\",disabled:!payment.canBeDeleted,icon:/*#__PURE__*/_jsx(DeleteOutlined,{})})})})]});}}]})]});}","map":{"version":3,"sources":["D:/ReactProjetos/alganews-admin/src/app/views/PaymentList.view.tsx"],"names":["Button","DatePicker","Descriptions","notification","Popconfirm","Row","Space","Table","Tag","Tooltip","moment","useEffect","useState","EyeOutlined","DeleteOutlined","usePayments","confirm","useBreakpoint","DoubleConfirm","Link","Forbidden","useBreadcrumb","PaymentListView","xs","payments","fetching","query","selected","fetchPayments","setQuery","approvePaymentsInBatch","setSelected","deleteExistingPayment","forbidden","setForbidden","catch","err","data","status","width","justifyContent","length","success","message","date","scheduledToYearMonth","format","undefined","content","p","f","sorter","order","direction","replace","sort","current","page","onChange","total","totalElements","pageSize","size","selectedRowKeys","getCheckboxProps","payment","canBeApproved","disabled","title","responsive","render","payee","name","scheduledTo","starts","accountingPeriod","startsOn","ends","endsOn","approvedAt","id","canBeDeleted","cancelText","onOk","dataIndex","ellipsis","align","a","b","period","approvalDate","formattedApprovalDate"],"mappings":"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","sourcesContent":["import {\n  Button,\n  DatePicker,\n  Descriptions,\n  notification,\n  Popconfirm,\n  Row,\n  Space,\n  Table,\n  Tag,\n  Tooltip,\n} from 'antd';\nimport { Payment } from 'danielbonifacio-sdk';\nimport moment from 'moment';\nimport { useEffect, useState } from 'react';\nimport { EyeOutlined, DeleteOutlined } from '@ant-design/icons';\nimport usePayments from '../../core/hooks/usePayments';\nimport confirm from 'antd/lib/modal/confirm';\nimport { SorterResult } from 'antd/lib/table/interface';\nimport useBreakpoint from 'antd/lib/grid/hooks/useBreakpoint';\nimport DoubleConfirm from '../components/DoubleConfirm';\nimport { Link } from 'react-router-dom';\nimport Forbidden from '../components/Forbidden';\nimport useBreadcrumb from '../../core/hooks/useBreadcrumb';\n\nexport default function PaymentListView() {\n  useBreadcrumb('Pagamentos/Consulta');\n  const { xs } = useBreakpoint();\n  const {\n    payments,\n    fetching,\n    query,\n    selected,\n    fetchPayments,\n    setQuery,\n    approvePaymentsInBatch,\n    setSelected,\n    deleteExistingPayment,\n  } = usePayments();\n\n  const [forbidden, setForbidden] = useState(false);\n\n  useEffect(() => {\n    fetchPayments().catch((err) => {\n      if (err?.data?.status === 403) {\n        setForbidden(true);\n        return;\n      }\n      throw err;\n    });\n  }, [fetchPayments]);\n\n  if (forbidden) return <Forbidden />;\n\n  return (\n    <>\n      <Row justify={'space-between'} gutter={24}>\n        <Space\n          style={{\n            width: '100%',\n            ...(!xs && { justifyContent: 'space-between' }),\n          }}\n          direction={xs ? 'vertical' : 'horizontal'}\n        >\n          <DoubleConfirm\n            popConfirmTitle={\n              selected.length === 1\n                ? 'Você deseja aprovar o agendamento selecionado?'\n                : 'Você deseja aprovar os agendamentos selecionados?'\n            }\n            disabled={selected.length === 0}\n            modalTitle={'Aprovar agendamento'}\n            modalContent={\n              'Esta é uma ação irreversível. Ao aprovar um agendamento, ele não poderá ser removido!'\n            }\n            onConfirm={async () => {\n              await approvePaymentsInBatch(selected as number[]);\n              notification.success({\n                message: 'Os pagamentos selecionados foram aprovados',\n              });\n            }}\n          >\n            <Button\n              block={xs}\n              type={'primary'}\n              disabled={selected.length === 0}\n            >\n              Aprovar agendamentos\n            </Button>\n          </DoubleConfirm>\n          <DatePicker.MonthPicker\n            style={{ width: xs ? '100%' : 240 }}\n            format={'MMMM - YYYY'}\n            placeholder={'Filtrar por mês'}\n            onChange={(date) => {\n              setQuery({\n                scheduledToYearMonth: date ? date.format('YYYY-MM') : undefined,\n              });\n            }}\n          />\n        </Space>\n      </Row>\n      <Table<Payment.Summary>\n        dataSource={payments?.content}\n        rowKey='id'\n        loading={fetching}\n        onChange={(p, f, sorter) => {\n          const { order } = sorter as SorterResult<Payment.Summary>;\n          const direction = order?.replace('end', '');\n          if (direction && direction !== query.sort![1])\n            setQuery({\n              sort: [query.sort![0], direction as 'asc' | 'desc'],\n            });\n        }}\n        pagination={{\n          current: query.page ? query.page + 1 : 1,\n          onChange: (page) => setQuery({ page: page - 1 }),\n          total: payments?.totalElements,\n          pageSize: query.size,\n        }}\n        rowSelection={{\n          selectedRowKeys: selected,\n          onChange: setSelected,\n          getCheckboxProps(payment) {\n            return !payment.canBeApproved ? { disabled: true } : {};\n          },\n        }}\n        columns={[\n          {\n            title: 'Agendamentos',\n            responsive: ['xs'],\n            render(payment: Payment.Summary) {\n              return (\n                <Descriptions column={1} size={'small'}>\n                  <Descriptions.Item label={'Editor'}>\n                    {payment.payee.name}\n                  </Descriptions.Item>\n                  <Descriptions.Item label={'Agendamento'}>\n                    {moment(payment.scheduledTo).format('DD/MM/YYYY')}\n                  </Descriptions.Item>\n                  <Descriptions.Item label={'Período'}>\n                    {(() => {\n                      const starts = moment(\n                        payment.accountingPeriod.startsOn\n                      ).format('DD/MM/YYYY');\n                      const ends = moment(\n                        payment.accountingPeriod.endsOn\n                      ).format('DD/MM/YYYY');\n                      return `${starts} - ${ends}`;\n                    })()}\n                  </Descriptions.Item>\n                  <Descriptions.Item label={'Status'}>\n                    <Tag color={payment.approvedAt ? 'green' : 'warning'}>\n                      {payment.approvedAt\n                        ? `Aprovado em ${moment(payment.approvedAt).format(\n                            'DD/MM/YYYY'\n                          )}`\n                        : 'Aguardando aprovação'}\n                    </Tag>\n                  </Descriptions.Item>\n                  <Descriptions.Item label={'Ações'}>\n                    <Tooltip title={'Detalhar'} placement={xs ? 'top' : 'left'}>\n                      <Link to={`/pagamentos/${payment.id}`}>\n                        <Button size={'small'} icon={<EyeOutlined />} />\n                      </Link>\n                    </Tooltip>\n                    <Popconfirm\n                      title='Remover agendamento?'\n                      disabled={!payment.canBeDeleted}\n                      onConfirm={() => {\n                        confirm({\n                          title: 'Remover agendamento',\n                          cancelText: 'Cancelar',\n                          onOk() {\n                            deleteExistingPayment(payment.id);\n                          },\n                          content:\n                            'Esta é uma ação irreversível. Ao remover um agendamento, ele não poderá ser recuperado!',\n                        });\n                      }}\n                    >\n                      <Tooltip\n                        title={\n                          payment.canBeDeleted\n                            ? 'Remover'\n                            : 'Pagamento já aprovado'\n                        }\n                        placement={xs ? 'bottom' : 'right'}\n                      >\n                        <Button\n                          disabled={!payment.canBeDeleted}\n                          icon={<DeleteOutlined />}\n                          size={'small'}\n                        />\n                      </Tooltip>\n                    </Popconfirm>\n                  </Descriptions.Item>\n                </Descriptions>\n              );\n            },\n          },\n          {\n            dataIndex: 'payee',\n            title: 'Editor',\n            responsive: ['sm'],\n            ellipsis: true,\n            width: 180,\n            render(payee: Payment.Summary['payee']) {\n              return <Link to={`/usuarios/${payee.id}`}>{payee.name}</Link>;\n            },\n          },\n          {\n            dataIndex: 'scheduledTo',\n            title: 'Agendamento',\n            align: 'center',\n            width: 140,\n            sorter(a, b) {\n              return 0;\n            },\n            responsive: ['sm'],\n            render(date: string) {\n              return moment(date).format('DD/MM/YYYY');\n            },\n          },\n          {\n            dataIndex: 'accountingPeriod',\n            title: 'Período',\n            align: 'center',\n            responsive: ['sm'],\n            width: 240,\n            render(period: Payment.Summary['accountingPeriod']) {\n              const starts = moment(period.startsOn).format('DD/MM/YYYY');\n              const ends = moment(period.endsOn).format('DD/MM/YYYY');\n              return `${starts} - ${ends}`;\n            },\n          },\n          {\n            dataIndex: 'approvedAt',\n            title: 'Status',\n            align: 'center',\n            width: 180,\n            responsive: ['sm'],\n            render(approvalDate: Payment.Summary['approvedAt']) {\n              const formattedApprovalDate =\n                moment(approvalDate).format('DD/MM/YYYY');\n\n              return (\n                <Tag color={approvalDate ? 'green' : 'warning'}>\n                  {approvalDate\n                    ? `Aprovado em ${formattedApprovalDate}`\n                    : 'Aguardando aprovação'}\n                </Tag>\n              );\n            },\n          },\n          {\n            dataIndex: 'id',\n            title: 'Ações',\n            responsive: ['sm'],\n            width: 100,\n            render(id: number, payment) {\n              return (\n                <>\n                  <Tooltip title={'Detalhar'} placement='left'>\n                    <Link to={`/pagamentos/${id}`}>\n                      <Button size='small' icon={<EyeOutlined />} />\n                    </Link>\n                  </Tooltip>\n                  <Popconfirm\n                    title='Remover agendamento?'\n                    disabled={!payment.canBeDeleted}\n                    onConfirm={() => {\n                      confirm({\n                        title: 'Remover agendamento',\n                        cancelText: 'Cancelar',\n                        onOk() {\n                          deleteExistingPayment(id);\n                        },\n                        content:\n                          'Esta é uma ação irreversível. Ao remover um agendamento, ele não poderá ser recuperado!',\n                      });\n                    }}\n                  >\n                    <Tooltip\n                      title={\n                        payment.canBeDeleted\n                          ? 'Remover'\n                          : 'Pagamento já aprovado'\n                      }\n                      placement='right'\n                    >\n                      <Button\n                        size='small'\n                        disabled={!payment.canBeDeleted}\n                        icon={<DeleteOutlined />}\n                      />\n                    </Tooltip>\n                  </Popconfirm>\n                </>\n              );\n            },\n          },\n        ]}\n      />\n    </>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}