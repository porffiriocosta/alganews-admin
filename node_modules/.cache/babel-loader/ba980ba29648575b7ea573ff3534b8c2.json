{"ast":null,"code":"import _objectSpread from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Button,Row,Table,Form,Input,Col,notification,Popconfirm}from'antd';import{useEffect}from'react';import{DeleteOutlined,CheckCircleOutlined,ReloadOutlined,PlusCircleOutlined}from'@ant-design/icons';import useEntriesCategories from'../../core/hooks/useEntriesCategories';import Modal from'antd/lib/modal/Modal';import{useState}from'react';import{useCallback}from'react';import Forbidden from'../components/Forbidden';import useBreakpoint from'antd/lib/grid/hooks/useBreakpoint';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function EntryCategoryManager(props){var _useBreakpoint=useBreakpoint(),xs=_useBreakpoint.xs;var _useEntriesCategories=useEntriesCategories(),expenses=_useEntriesCategories.expenses,fetchCategories=_useEntriesCategories.fetchCategories,fetching=_useEntriesCategories.fetching,revenues=_useEntriesCategories.revenues,deleteCategory=_useEntriesCategories.deleteCategory;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showCreationModal=_useState2[0],setShowCreationModal=_useState2[1];var openCreationModal=useCallback(function(){return setShowCreationModal(true);},[]);var closeCreationModal=useCallback(function(){return setShowCreationModal(false);},[]);var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),forbidden=_useState4[0],setForbidden=_useState4[1];useEffect(function(){fetchCategories().catch(function(err){var _err$data;if((err===null||err===void 0?void 0:(_err$data=err.data)===null||_err$data===void 0?void 0:_err$data.status)===403){setForbidden(true);return;}throw err;});},[fetchCategories]);if(forbidden)return/*#__PURE__*/_jsx(Forbidden,{});return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Modal,{footer:null,title:'Adicionar categoria',visible:showCreationModal,onCancel:closeCreationModal,destroyOnClose:true,children:/*#__PURE__*/_jsx(CategoryForm,{onSuccess:function onSuccess(){closeCreationModal();notification.success({message:'Categoria cadastrada com sucesso'});}})}),/*#__PURE__*/_jsxs(Row,{justify:'space-between',style:{marginBottom:16},children:[/*#__PURE__*/_jsx(Button,{onClick:fetchCategories,icon:/*#__PURE__*/_jsx(ReloadOutlined,{}),children:xs?'Atualizar':'Atualizar categorias'}),/*#__PURE__*/_jsx(Button,{onClick:openCreationModal,icon:/*#__PURE__*/_jsx(PlusCircleOutlined,{}),type:'primary',children:xs?'Adicionar':'Adicionar categoria'})]}),/*#__PURE__*/_jsx(Table,{size:\"small\",rowKey:'id',loading:fetching,dataSource:props.type==='EXPENSE'?expenses:revenues,columns:[{dataIndex:'name',title:'Descrição'},{dataIndex:'totalEntries',title:'Vínculos',align:'right'},{dataIndex:'id',title:'Ações',align:'right',render:function render(id,record){return/*#__PURE__*/_jsx(Popconfirm,{title:'Remover categoria?',disabled:!record.canBeDeleted,onConfirm:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return deleteCategory(id);case 2:notification.success({message:'Categoria removida com sucesso'});case 3:case\"end\":return _context.stop();}}},_callee);})),children:/*#__PURE__*/_jsx(Button,{danger:true,type:'ghost',size:'small',icon:/*#__PURE__*/_jsx(DeleteOutlined,{}),disabled:!record.canBeDeleted})});}}]})]});}function CategoryForm(props){var onSuccess=props.onSuccess;var _useEntriesCategories2=useEntriesCategories(),createCategory=_useEntriesCategories2.createCategory;var handleFormSubmit=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(form){var newCategoryDTO;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:newCategoryDTO=_objectSpread(_objectSpread({},form),{},{type:'EXPENSE'});_context2.next=3;return createCategory(newCategoryDTO);case 3:onSuccess();case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}(),[createCategory,onSuccess]);return/*#__PURE__*/_jsx(Form,{layout:'vertical',onFinish:handleFormSubmit,children:/*#__PURE__*/_jsxs(Row,{justify:'end',children:[/*#__PURE__*/_jsx(Col,{xs:24,children:/*#__PURE__*/_jsx(Form.Item,{label:'Categoria',name:'name',rules:[{required:true,message:'O nome da categoria é obrigatório'}],children:/*#__PURE__*/_jsx(Input,{placeholder:'E.g.: Infra'})})}),/*#__PURE__*/_jsx(Button,{type:'primary',htmlType:'submit',icon:/*#__PURE__*/_jsx(CheckCircleOutlined,{}),children:\"Cadastrar categoria\"})]})});}","map":{"version":3,"sources":["D:/ReactProjetos/alganews-admin/src/app/features/EntryCategoryManager.tsx"],"names":["Button","Row","Table","Form","Input","Col","notification","Popconfirm","useEffect","DeleteOutlined","CheckCircleOutlined","ReloadOutlined","PlusCircleOutlined","useEntriesCategories","Modal","useState","useCallback","Forbidden","useBreakpoint","EntryCategoryManager","props","xs","expenses","fetchCategories","fetching","revenues","deleteCategory","showCreationModal","setShowCreationModal","openCreationModal","closeCreationModal","forbidden","setForbidden","catch","err","data","status","success","message","marginBottom","type","dataIndex","title","align","render","id","record","canBeDeleted","CategoryForm","onSuccess","createCategory","handleFormSubmit","form","newCategoryDTO","required"],"mappings":"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","sourcesContent":["import {\n  Button,\n  Row,\n  Table,\n  Form,\n  Input,\n  Col,\n  notification,\n  Popconfirm,\n} from 'antd';\nimport { CashFlow } from 'danielbonifacio-sdk';\nimport { useEffect } from 'react';\nimport {\n  DeleteOutlined,\n  CheckCircleOutlined,\n  ReloadOutlined,\n  PlusCircleOutlined,\n} from '@ant-design/icons';\nimport useEntriesCategories from '../../core/hooks/useEntriesCategories';\nimport Modal from 'antd/lib/modal/Modal';\nimport { useState } from 'react';\nimport { useCallback } from 'react';\nimport Forbidden from '../components/Forbidden';\nimport useBreakpoint from 'antd/lib/grid/hooks/useBreakpoint';\n\nexport default function EntryCategoryManager(props: {\n  type: 'EXPENSE' | 'REVENUE';\n}) {\n  const { xs } = useBreakpoint();\n  const { expenses, fetchCategories, fetching, revenues, deleteCategory } =\n    useEntriesCategories();\n\n  const [showCreationModal, setShowCreationModal] = useState(false);\n\n  const openCreationModal = useCallback(() => setShowCreationModal(true), []);\n  const closeCreationModal = useCallback(() => setShowCreationModal(false), []);\n\n  const [forbidden, setForbidden] = useState(false);\n\n  useEffect(() => {\n    fetchCategories().catch((err) => {\n      if (err?.data?.status === 403) {\n        setForbidden(true);\n        return;\n      }\n      throw err;\n    });\n  }, [fetchCategories]);\n\n  if (forbidden) return <Forbidden />;\n\n  return (\n    <>\n      <Modal\n        footer={null}\n        title={'Adicionar categoria'}\n        visible={showCreationModal}\n        onCancel={closeCreationModal}\n        destroyOnClose\n      >\n        <CategoryForm\n          onSuccess={() => {\n            closeCreationModal();\n            notification.success({\n              message: 'Categoria cadastrada com sucesso',\n            });\n          }}\n        />\n      </Modal>\n      <Row justify={'space-between'} style={{ marginBottom: 16 }}>\n        <Button onClick={fetchCategories} icon={<ReloadOutlined />}>\n          {xs ? 'Atualizar' : 'Atualizar categorias'}\n        </Button>\n        <Button\n          onClick={openCreationModal}\n          icon={<PlusCircleOutlined />}\n          type={'primary'}\n        >\n          {xs ? 'Adicionar' : 'Adicionar categoria'}\n        </Button>\n      </Row>\n      <Table<CashFlow.CategorySummary>\n        size='small'\n        rowKey={'id'}\n        loading={fetching}\n        dataSource={props.type === 'EXPENSE' ? expenses : revenues}\n        columns={[\n          {\n            dataIndex: 'name',\n            title: 'Descrição',\n          },\n          {\n            dataIndex: 'totalEntries',\n            title: 'Vínculos',\n            align: 'right',\n          },\n          {\n            dataIndex: 'id',\n            title: 'Ações',\n            align: 'right',\n            render(id: number, record) {\n              return (\n                <Popconfirm\n                  title={'Remover categoria?'}\n                  disabled={!record.canBeDeleted}\n                  onConfirm={async () => {\n                    await deleteCategory(id);\n                    notification.success({\n                      message: 'Categoria removida com sucesso',\n                    });\n                  }}\n                >\n                  <Button\n                    danger\n                    type={'ghost'}\n                    size={'small'}\n                    icon={<DeleteOutlined />}\n                    disabled={!record.canBeDeleted}\n                  />\n                </Popconfirm>\n              );\n            },\n          },\n        ]}\n      />\n    </>\n  );\n}\n\nfunction CategoryForm(props: { onSuccess: () => any }) {\n  const { onSuccess } = props;\n\n  const { createCategory } = useEntriesCategories();\n\n  const handleFormSubmit = useCallback(\n    async (form: CashFlow.CategoryInput) => {\n      const newCategoryDTO: CashFlow.CategoryInput = {\n        ...form,\n        type: 'EXPENSE',\n      };\n\n      await createCategory(newCategoryDTO);\n      onSuccess();\n    },\n    [createCategory, onSuccess]\n  );\n\n  return (\n    <Form layout={'vertical'} onFinish={handleFormSubmit}>\n      <Row justify={'end'}>\n        <Col xs={24}>\n          <Form.Item\n            label={'Categoria'}\n            name={'name'}\n            rules={[\n              { required: true, message: 'O nome da categoria é obrigatório' },\n            ]}\n          >\n            <Input placeholder={'E.g.: Infra'} />\n          </Form.Item>\n        </Col>\n        <Button\n          type={'primary'}\n          htmlType={'submit'}\n          icon={<CheckCircleOutlined />}\n        >\n          Cadastrar categoria\n        </Button>\n      </Row>\n    </Form>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}