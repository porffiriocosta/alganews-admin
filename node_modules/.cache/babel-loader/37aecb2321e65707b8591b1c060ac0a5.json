{"ast":null,"code":"import _regeneratorRuntime from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Col,Row,Form,Input,DatePicker,Divider,Space,Button,Select,Skeleton}from'antd';import{CashFlowService}from'danielbonifacio-sdk';import{useState,useEffect,useMemo,useCallback}from'react';import moment from'moment';import{useForm}from'antd/lib/form/Form';import CurrencyInput from'../components/CurrencyInput';import useEntriesCategories from'../../core/hooks/useEntriesCategories';import useCashFlow from'../../core/hooks/useCashFlow';import Forbidden from'../components/Forbidden';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function EntryForm(_ref){var type=_ref.type,onSuccess=_ref.onSuccess,editingEntry=_ref.editingEntry;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useForm=useForm(),_useForm2=_slicedToArray(_useForm,1),form=_useForm2[0];var _useEntriesCategories=useEntriesCategories(),revenues=_useEntriesCategories.revenues,expenses=_useEntriesCategories.expenses,fetching=_useEntriesCategories.fetching,fetchCategories=_useEntriesCategories.fetchCategories;var _useCashFlow=useCashFlow(type),createEntry=_useCashFlow.createEntry,fetchingEntries=_useCashFlow.fetching,updateEntry=_useCashFlow.updateEntry;var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),forbidden=_useState4[0],setForbidden=_useState4[1];useEffect(function(){fetchCategories().catch(function(err){var _err$data;if((err===null||err===void 0?void 0:(_err$data=err.data)===null||_err$data===void 0?void 0:_err$data.status)===403){setForbidden(true);return;}throw err;});},[fetchCategories]);useEffect(function(){if(editingEntry){setLoading(true);CashFlowService.getExistingEntry(editingEntry).then(function(entry){return _objectSpread(_objectSpread({},entry),{},{transactedOn:moment(entry.transactedOn)});}).then(form.setFieldsValue).finally(function(){return setLoading(false);});}},[editingEntry,form]);var categories=useMemo(function(){return type==='EXPENSE'?expenses:revenues;},[expenses,revenues,type]);var handleFormSubmit=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(form){var newEntryDTO;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:newEntryDTO=_objectSpread(_objectSpread({},form),{},{transactedOn:form.transactedOn.format('YYYY-MM-DD'),type:type});if(!editingEntry){_context.next=6;break;}_context.next=4;return updateEntry(editingEntry,newEntryDTO);case 4:_context.next=8;break;case 6:_context.next=8;return createEntry(newEntryDTO);case 8:onSuccess();case 9:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}(),[type,createEntry,onSuccess,updateEntry,editingEntry]);if(forbidden)return/*#__PURE__*/_jsx(Forbidden,{});return loading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Skeleton,{}),/*#__PURE__*/_jsx(Skeleton,{title:false}),/*#__PURE__*/_jsx(Skeleton,{title:false})]}):/*#__PURE__*/_jsxs(Form,{autoComplete:'off',form:form,layout:'vertical',onFinish:handleFormSubmit,children:[/*#__PURE__*/_jsxs(Row,{gutter:16,children:[/*#__PURE__*/_jsx(Col,{xs:24,children:/*#__PURE__*/_jsx(Form.Item,{label:'Descrição',name:'description',rules:[{required:true,message:'Campo obrigatório'}],children:/*#__PURE__*/_jsx(Input,{placeholder:'Pagamento da AWS'})})}),/*#__PURE__*/_jsx(Col,{xs:24,children:/*#__PURE__*/_jsx(Form.Item,{label:'Categoria',name:['category','id'],rules:[{required:true,message:'Campo obrigatório'}],children:/*#__PURE__*/_jsx(Select,{loading:fetching,placeholder:'Selecione uma categoria',children:categories.map(function(category){return/*#__PURE__*/_jsx(Select.Option,{value:category.id,children:category.name},category.id);})})})}),/*#__PURE__*/_jsx(Col,{xs:24,lg:12,children:/*#__PURE__*/_jsx(Form.Item,{label:'Montante',name:'amount',rules:[{required:true,message:'Campo obrigatório'}],children:/*#__PURE__*/_jsx(CurrencyInput,{defaultValue:'R$ 0,00',onChange:function onChange(_,value){return form.setFieldsValue({amount:value});}})})}),/*#__PURE__*/_jsx(Col,{xs:24,lg:12,children:/*#__PURE__*/_jsx(Form.Item,{label:type==='EXPENSE'?'Data da saída':'Data da entrada',name:'transactedOn',rules:[{required:true,message:'Campo obrigatório'}],children:/*#__PURE__*/_jsx(DatePicker,{format:'DD/MM/YYYY',style:{width:'100%'},disabledDate:function disabledDate(date){return date.isAfter(moment());}})})})]}),/*#__PURE__*/_jsx(Divider,{style:{marginTop:0}}),/*#__PURE__*/_jsx(Row,{justify:'end',children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{children:\"Cancelar\"}),/*#__PURE__*/_jsxs(Button,{loading:fetchingEntries,type:'primary',htmlType:'submit',children:[editingEntry?'Atualizar':'Cadastrar',' ',type==='EXPENSE'?'despesa':'receita']})]})})]});}","map":{"version":3,"sources":["D:/ReactProjetos/alganews-admin/src/app/features/EntryForm.tsx"],"names":["Col","Row","Form","Input","DatePicker","Divider","Space","Button","Select","Skeleton","CashFlowService","useState","useEffect","useMemo","useCallback","moment","useForm","CurrencyInput","useEntriesCategories","useCashFlow","Forbidden","EntryForm","type","onSuccess","editingEntry","loading","setLoading","form","revenues","expenses","fetching","fetchCategories","createEntry","fetchingEntries","updateEntry","forbidden","setForbidden","catch","err","data","status","getExistingEntry","then","entry","transactedOn","setFieldsValue","finally","categories","handleFormSubmit","newEntryDTO","format","required","message","map","category","id","name","_","value","amount","width","date","isAfter","marginTop"],"mappings":"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","sourcesContent":["import {\n  Col,\n  Row,\n  Form,\n  Input,\n  DatePicker,\n  Divider,\n  Space,\n  Button,\n  Select,\n  Skeleton,\n} from 'antd';\nimport { CashFlow, CashFlowService } from 'danielbonifacio-sdk';\nimport { useState, useEffect, useMemo, useCallback } from 'react';\nimport moment, { Moment } from 'moment';\nimport { useForm } from 'antd/lib/form/Form';\n\nimport CurrencyInput from '../components/CurrencyInput';\nimport useEntriesCategories from '../../core/hooks/useEntriesCategories';\nimport useCashFlow from '../../core/hooks/useCashFlow';\nimport Forbidden from '../components/Forbidden';\n\ntype EntryFormSubmit = Omit<CashFlow.EntryInput, 'transactedOn'> & {\n  transactedOn: Moment;\n};\n\ninterface EntryFormProps {\n  type: 'EXPENSE' | 'REVENUE';\n  onSuccess: () => any;\n  editingEntry?: number | undefined;\n}\n\nexport default function EntryForm({\n  type,\n  onSuccess,\n  editingEntry,\n}: EntryFormProps) {\n  const [loading, setLoading] = useState(false);\n\n  const [form] = useForm();\n  const { revenues, expenses, fetching, fetchCategories } =\n    useEntriesCategories();\n\n  const {\n    createEntry,\n    fetching: fetchingEntries,\n    updateEntry,\n  } = useCashFlow(type);\n\n  const [forbidden, setForbidden] = useState(false);\n\n  useEffect(() => {\n    fetchCategories().catch((err) => {\n      if (err?.data?.status === 403) {\n        setForbidden(true);\n        return;\n      }\n      throw err;\n    });\n  }, [fetchCategories]);\n\n  useEffect(() => {\n    if (editingEntry) {\n      setLoading(true);\n      CashFlowService.getExistingEntry(editingEntry)\n        .then((entry) => ({\n          ...entry,\n          transactedOn: moment(entry.transactedOn),\n        }))\n        .then(form.setFieldsValue)\n        .finally(() => setLoading(false));\n    }\n  }, [editingEntry, form]);\n\n  const categories = useMemo(\n    () => (type === 'EXPENSE' ? expenses : revenues),\n    [expenses, revenues, type]\n  );\n\n  const handleFormSubmit = useCallback(\n    async (form: EntryFormSubmit) => {\n      const newEntryDTO: CashFlow.EntryInput = {\n        ...form,\n        transactedOn: form.transactedOn.format('YYYY-MM-DD'),\n        type,\n      };\n\n      editingEntry\n        ? await updateEntry(editingEntry, newEntryDTO)\n        : await createEntry(newEntryDTO);\n      onSuccess();\n    },\n    [type, createEntry, onSuccess, updateEntry, editingEntry]\n  );\n\n  if (forbidden) return <Forbidden />;\n\n  return loading ? (\n    <>\n      <Skeleton />\n      <Skeleton title={false} />\n      <Skeleton title={false} />\n    </>\n  ) : (\n    <Form\n      autoComplete={'off'}\n      form={form}\n      layout={'vertical'}\n      onFinish={handleFormSubmit}\n    >\n      <Row gutter={16}>\n        <Col xs={24}>\n          <Form.Item\n            label={'Descrição'}\n            name={'description'}\n            rules={[{ required: true, message: 'Campo obrigatório' }]}\n          >\n            <Input placeholder={'Pagamento da AWS'} />\n          </Form.Item>\n        </Col>\n        <Col xs={24}>\n          <Form.Item\n            label={'Categoria'}\n            name={['category', 'id']}\n            rules={[{ required: true, message: 'Campo obrigatório' }]}\n          >\n            <Select loading={fetching} placeholder={'Selecione uma categoria'}>\n              {categories.map((category) => (\n                <Select.Option key={category.id} value={category.id}>\n                  {category.name}\n                </Select.Option>\n              ))}\n            </Select>\n          </Form.Item>\n        </Col>\n        <Col xs={24} lg={12}>\n          <Form.Item\n            label={'Montante'}\n            name={'amount'}\n            rules={[{ required: true, message: 'Campo obrigatório' }]}\n          >\n            <CurrencyInput\n              defaultValue={'R$ 0,00'}\n              onChange={(_, value) =>\n                form.setFieldsValue({\n                  amount: value,\n                })\n              }\n            />\n          </Form.Item>\n        </Col>\n        <Col xs={24} lg={12}>\n          <Form.Item\n            label={type === 'EXPENSE' ? 'Data da saída' : 'Data da entrada'}\n            name={'transactedOn'}\n            rules={[{ required: true, message: 'Campo obrigatório' }]}\n          >\n            <DatePicker\n              format={'DD/MM/YYYY'}\n              style={{ width: '100%' }}\n              disabledDate={(date) => {\n                return date.isAfter(moment());\n              }}\n            />\n          </Form.Item>\n        </Col>\n      </Row>\n      <Divider style={{ marginTop: 0 }} />\n      <Row justify={'end'}>\n        <Space>\n          <Button>Cancelar</Button>\n          <Button\n            loading={fetchingEntries}\n            type={'primary'}\n            htmlType={'submit'}\n          >\n            {editingEntry ? 'Atualizar' : 'Cadastrar'}{' '}\n            {type === 'EXPENSE' ? 'despesa' : 'receita'}\n          </Button>\n        </Space>\n      </Row>\n    </Form>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}