{"ast":null,"code":"import _classCallCheck from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _regeneratorRuntime from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/ReactProjetos/alganews-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import axios from'axios';import qs from'qs';import pkceChallenge from'pkce-challenge';var APP_BASE_URL=process.env.REACT_APP_BASE_URL;var AUTH_BASE_URL=process.env.REACT_APP_AUTH_SERVER_BASE_URL;var authServer=axios.create({baseURL:AUTH_BASE_URL});authServer.interceptors.response.use(undefined,/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(error){var _error$response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if((error===null||error===void 0?void 0:(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401){AuthService.imperativelySendToLogout();}return _context.abrupt(\"return\",Promise.reject(error));case 2:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());var AuthService=/*#__PURE__*/function(){function AuthService(){_classCallCheck(this,AuthService);}_createClass(AuthService,null,[{key:\"imperativelySendToLogout\",value:function imperativelySendToLogout(){window.localStorage.clear();window.location.href=\"\".concat(AUTH_BASE_URL,\"/logout?redirect=\").concat(APP_BASE_URL);}},{key:\"getNewToken\",value:function(){var _getNewToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(config){var formUrlEncoded;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:formUrlEncoded=qs.stringify({refresh_token:config.refreshToken,code_verifier:config.codeVerifier,grant_type:'refresh_token',client_id:'alganews-admin'});return _context2.abrupt(\"return\",authServer.post('/oauth/token',formUrlEncoded,{headers:{'Content-Type':'application/x-www-form-urlencoded'}}).then(function(res){return res.data;}));case 2:case\"end\":return _context2.stop();}}},_callee2);}));function getNewToken(_x2){return _getNewToken.apply(this,arguments);}return getNewToken;}()},{key:\"getFirstAccessTokens\",value:function(){var _getFirstAccessTokens=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(config){var data,encodedData;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:data={code:config.code,code_verifier:config.codeVerifier,redirect_uri:config.redirectUri,grant_type:'authorization_code',client_id:'alganews-admin'};encodedData=qs.stringify(data);return _context3.abrupt(\"return\",authServer.post('/oauth/token',encodedData,{headers:{'Content-Type':'application/x-www-form-urlencoded'}}).then(function(res){return res.data;}));case 3:case\"end\":return _context3.stop();}}},_callee3);}));function getFirstAccessTokens(_x3){return _getFirstAccessTokens.apply(this,arguments);}return getFirstAccessTokens;}()},{key:\"getLoginScreenUrl\",value:function getLoginScreenUrl(codeChallenge){var config=qs.stringify({response_type:'code',client_id:'alganews-admin',redirect_uri:\"\".concat(window.location.origin,\"/authorize\"),code_challenge:codeChallenge,code_challenge_method:'S256'});return\"\".concat(AUTH_BASE_URL,\"/oauth/authorize?\").concat(config);}},{key:\"imperativelySendToLoginScreen\",value:function(){var _imperativelySendToLoginScreen=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var _yield$pkceChallenge,code_challenge,code_verifier,loginUrl;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return pkceChallenge();case 2:_yield$pkceChallenge=_context4.sent;code_challenge=_yield$pkceChallenge.code_challenge;code_verifier=_yield$pkceChallenge.code_verifier;this.setCodeVerifier(code_verifier);loginUrl=this.getLoginScreenUrl(code_challenge);// imperativo\n// gera efeito colateral\nwindow.location.href=loginUrl;case 8:case\"end\":return _context4.stop();}}},_callee4,this);}));function imperativelySendToLoginScreen(){return _imperativelySendToLoginScreen.apply(this,arguments);}return imperativelySendToLoginScreen;}()},{key:\"getAccessToken\",value:function getAccessToken(){return window.localStorage.getItem('accessToken');}},{key:\"setAccessToken\",value:function setAccessToken(token){return window.localStorage.setItem('accessToken',token);}},{key:\"getRefreshToken\",value:function getRefreshToken(){return window.localStorage.getItem('refreshToken');}},{key:\"setRefreshToken\",value:function setRefreshToken(token){return window.localStorage.setItem('refreshToken',token);}},{key:\"getCodeVerifier\",value:function getCodeVerifier(){return window.localStorage.getItem('codeVerifier');}},{key:\"setCodeVerifier\",value:function setCodeVerifier(getCodeVerifier){return window.localStorage.setItem('codeVerifier',getCodeVerifier);}}]);return AuthService;}();export{AuthService as default};","map":{"version":3,"sources":["D:/ReactProjetos/alganews-admin/src/auth/Authorization.service.ts"],"names":["axios","qs","pkceChallenge","APP_BASE_URL","process","env","REACT_APP_BASE_URL","AUTH_BASE_URL","REACT_APP_AUTH_SERVER_BASE_URL","authServer","create","baseURL","interceptors","response","use","undefined","error","status","AuthService","imperativelySendToLogout","Promise","reject","window","localStorage","clear","location","href","config","formUrlEncoded","stringify","refresh_token","refreshToken","code_verifier","codeVerifier","grant_type","client_id","post","headers","then","res","data","code","redirect_uri","redirectUri","encodedData","codeChallenge","response_type","origin","code_challenge","code_challenge_method","setCodeVerifier","loginUrl","getLoginScreenUrl","getItem","token","setItem","getCodeVerifier"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport qs from 'qs';\nimport pkceChallenge from 'pkce-challenge';\n\nconst APP_BASE_URL = process.env.REACT_APP_BASE_URL;\nconst AUTH_BASE_URL = process.env.REACT_APP_AUTH_SERVER_BASE_URL;\n\nconst authServer = axios.create({\n  baseURL: AUTH_BASE_URL,\n});\n\nauthServer.interceptors.response.use(undefined, async (error) => {\n  if (error?.response?.status === 401) {\n    AuthService.imperativelySendToLogout();\n  }\n\n  return Promise.reject(error);\n});\n\nexport interface OAuthAuthorizationTokenResponse {\n  access_token: string;\n  refresh_token: string;\n  token_type: 'bearer' | string;\n  expires_in: number;\n  scope: string;\n  [key: string]: string | number;\n}\n\nexport default class AuthService {\n  public static imperativelySendToLogout() {\n    window.localStorage.clear();\n    window.location.href = `${AUTH_BASE_URL}/logout?redirect=${APP_BASE_URL}`;\n  }\n\n  public static async getNewToken(config: {\n    refreshToken: string;\n    codeVerifier: string;\n  }) {\n    const formUrlEncoded = qs.stringify({\n      refresh_token: config.refreshToken,\n      code_verifier: config.codeVerifier,\n      grant_type: 'refresh_token',\n      client_id: 'alganews-admin',\n    });\n\n    return authServer\n      .post<OAuthAuthorizationTokenResponse>('/oauth/token', formUrlEncoded, {\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n        },\n      })\n      .then((res) => res.data);\n  }\n\n  public static async getFirstAccessTokens(config: {\n    code: string;\n    codeVerifier: string;\n    redirectUri: string;\n  }) {\n    const data = {\n      code: config.code,\n      code_verifier: config.codeVerifier,\n      redirect_uri: config.redirectUri,\n      grant_type: 'authorization_code',\n      client_id: 'alganews-admin',\n    };\n\n    const encodedData = qs.stringify(data);\n\n    return authServer\n      .post<OAuthAuthorizationTokenResponse>('/oauth/token', encodedData, {\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n        },\n      })\n      .then((res) => res.data);\n  }\n\n  public static getLoginScreenUrl(codeChallenge: string) {\n    const config = qs.stringify({\n      response_type: 'code',\n      client_id: 'alganews-admin',\n      redirect_uri: `${window.location.origin}/authorize`,\n      code_challenge: codeChallenge,\n      code_challenge_method: 'S256',\n    });\n\n    return `${AUTH_BASE_URL}/oauth/authorize?${config}`;\n  }\n\n  public static async imperativelySendToLoginScreen() {\n    const { code_challenge, code_verifier } = await pkceChallenge();\n    this.setCodeVerifier(code_verifier);\n\n    const loginUrl = this.getLoginScreenUrl(code_challenge);\n\n    // imperativo\n    // gera efeito colateral\n    window.location.href = loginUrl;\n  }\n\n  public static getAccessToken() {\n    return window.localStorage.getItem('accessToken');\n  }\n  public static setAccessToken(token: string) {\n    return window.localStorage.setItem('accessToken', token);\n  }\n\n  public static getRefreshToken() {\n    return window.localStorage.getItem('refreshToken');\n  }\n  public static setRefreshToken(token: string) {\n    return window.localStorage.setItem('refreshToken', token);\n  }\n\n  public static getCodeVerifier() {\n    return window.localStorage.getItem('codeVerifier');\n  }\n  public static setCodeVerifier(getCodeVerifier: string) {\n    return window.localStorage.setItem('codeVerifier', getCodeVerifier);\n  }\n}"]},"metadata":{},"sourceType":"module"}